{
  "kind": "build_request",
  "title": "Add TradingView Alert Log Page with Backend Storage",
  "projectName": "Trade Trace",
  "priority": "high",
  "requirements": [
    {
      "id": "REQ-1",
      "text": "Add a stable `WebhookAlert` record type to the backend and an append-only log (stable array or map) that persists all incoming TradingView webhook payloads. Each record must capture: a unique alert ID, receipt timestamp (nanoseconds), raw JSON payload as Text, ticker, action, strategy, alert_name, alert_id fields parsed from the payload, and a processing status (e.g., #received, #processed, #error).",
      "target": "backend",
      "source": {
        "messageIds": [
          "msg-18",
          "msg-20"
        ],
        "quotes": [
          "add a log for all received alerts from trading view in caffeine",
          "trading view fired 2 alerts and i don't see no movement in my caffeine app"
        ]
      },
      "acceptanceCriteria": [
        "A `WebhookAlert` stable type exists in backend/main.mo.",
        "Every call to the existing `receiveWebhook` (or equivalent) endpoint appends a new `WebhookAlert` entry to the stable log.",
        "A `getWebhookAlerts` query method returns all stored `WebhookAlert` entries, newest first.",
        "A `clearWebhookAlerts` update method allows clearing the log (admin utility).",
        "Re-deploying the canister does NOT wipe previously stored alerts (stable storage used)."
      ]
    },
    {
      "id": "REQ-2",
      "text": "Add a `useWebhookAlerts` React Query hook in `frontend/src/hooks/useQueries.ts` that calls the backend `getWebhookAlerts` query and returns the list of `WebhookAlert` records. Polling interval should be 10 seconds so new alerts appear automatically.",
      "target": "frontend",
      "source": {
        "messageIds": [
          "msg-18",
          "msg-20"
        ]
      },
      "acceptanceCriteria": [
        "Hook is exported from useQueries.ts.",
        "Hook polls the backend every 10 seconds.",
        "Hook returns typed WebhookAlert array matching the backend type."
      ]
    },
    {
      "id": "REQ-3",
      "text": "Create a new page `frontend/src/pages/AlertLog.tsx` at route `/alerts` that displays all received TradingView webhook alerts. The page must show: a sortable table with columns for Received At (human-readable timestamp), Ticker, Action, Strategy, Alert Name, Alert ID, and Status badge. Each row must be expandable to reveal the full raw JSON payload. Include a Refresh button and a total count. Show an empty state message when no alerts have been received. Match the existing dark theme and design conventions used in Dashboard.tsx and TraceDetail.tsx.",
      "target": "frontend",
      "source": {
        "messageIds": [
          "msg-18",
          "msg-20"
        ],
        "quotes": [
          "add a log for all received alerts from trading view in caffeine",
          "where can i see the log on my caffeine app"
        ]
      },
      "acceptanceCriteria": [
        "Route /alerts renders the AlertLog page.",
        "Table displays all fields: Received At, Ticker, Action, Strategy, Alert Name, Alert ID, Status.",
        "Status is rendered using a styled badge (received/processed/error).",
        "Clicking a row expands it to show the full raw JSON payload with syntax highlighting.",
        "Refresh button triggers a manual re-fetch.",
        "Empty state is shown when no alerts are stored.",
        "Page auto-polls every 10 seconds."
      ]
    },
    {
      "id": "REQ-4",
      "text": "Add an 'Alert Log' navigation link to the top nav bar in `frontend/src/components/Layout.tsx` alongside the existing Dashboard and Settings links, pointing to `/alerts`. Apply the same active-state highlight style used by the other nav links.",
      "target": "frontend",
      "source": {
        "messageIds": [
          "msg-18",
          "msg-20"
        ]
      },
      "acceptanceCriteria": [
        "Nav bar shows an 'Alert Log' link between Dashboard and Settings.",
        "Link navigates to /alerts.",
        "Active state is highlighted when the user is on /alerts."
      ]
    },
    {
      "id": "REQ-5",
      "text": "Register the `/alerts` route in `frontend/src/App.tsx` using the existing TanStack Router setup, pointing to the new `AlertLog` page component.",
      "target": "frontend",
      "source": {
        "messageIds": [
          "msg-18",
          "msg-20"
        ]
      },
      "acceptanceCriteria": [
        "Navigating to /alerts renders the AlertLog page without a 404.",
        "Existing routes (/, /trace/$traceId, /settings) are unaffected."
      ]
    }
  ],
  "constraints": [
    "Do not break or modify existing webhook receiving logic â€” only extend it to also append to the alert log.",
    "Use stable storage for the webhook alert log so data survives canister upgrades.",
    "Do not edit files listed in frontend.immutablePaths.",
    "Match the existing dark OKLCH theme and Tailwind design conventions."
  ],
  "nonGoals": [
    "Do not add authentication/authorization gating to the alert log page.",
    "Do not modify the TradingView webhook URL or webhook payload format.",
    "Do not add filtering or search to the alert log in this iteration.",
    "Do not rebuild or change the Ghost forwarding or Tradovate sync logic."
  ],
  "imageRequirements": {
    "required": [],
    "edits": []
  }
}